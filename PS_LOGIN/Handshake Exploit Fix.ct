// Author: Cups
// Date: 31/10/2017
[ENABLE]
alloc(newmem, 128) // New memory cave used for performing the key length check
label(return) // Address to return

/* 404E60 is the CUserCrypto::KeyInit function. The keylen parameter describes the length of the RSA encrypted response from the client, which is the 2nd parameter to the function. Function parameters are stored in the EBP register, and are in reverse order. EBP+08 is the pointer to the second parameter (as all parameters are an
integer, so 4 bytes in size) */
ps_login.exe+4E84:
jmp newmem // Jump to our new memory
return:

// New memory for checking the key length
newmem:

// We overwrote this code when inserting our jump
push eax
mov ebx,ecx
mov eax,esi

// If the key length is not 128 bytes, jump to the end of the function and do nothing
cmp ecx,80
jne ps_login.exe+4FAE

// Key is valid, continue processing as normal
jmp return

[DISABLE]
dealloc(newmem)

ps_login.exe+4E84:
push eax
mov ebx,ecx
mov eax,esi
